# Задание

### Описание

CDR - сall data record - формат файла, содержащего в себе информацию о времени, стоимости и типа вызова абонента.
В зависимости от вендора, cdr может быть в разном формате, но всегда содержит следующие данные:
- номер абонента (все номера сгенерированы. все совпадения случайны)
- тип вызова (01 - исходящие, 02 - входящие)
- дата и время начала звонка (`YYYYMMDDHH24MMSS`)
- дата и время окончания звонка
- тип тарфа (см. ниже)

Вот пример готовой записи cdr:

`02, 79876543221, 20230321160455, 20230321163211, 11`

### Тарифы

- (06) Безлимит 300: 300 минут - за тарифный период (Тарифным периодом будем считать все звонки совершенные в текущей
выгрузке) стоят фиксированную сумму - 100р. Каждая последующая минута - 1р. 

- (03) Поминутный: 1 минута разговора - 1.5 рубля. 

- (11) Обычный:
    - Входящие - бесплатно
    - Исходящие - первые 100 минут по 0.5р/минута, после по тарифу "поминутный".

### Задача

- Конечная задача будет протарифицировать абонентов: т.е. сгенерировать файл отчета для каждого абонента, содержащий в
себе номер, индекс тарифа, все совершенные звонки в календарном порядке с выпиской их стоимости по тарифу (для безлимита
первые 300 минут - 0р, а с 301 уже расчет), продолжительность звонка, итоговая сумма списания. 

- Для реализации функционала разрешается использовать только средства стандартной библиотеки `java (JDK 11)`. Система
сборки - `maven`. Приложение должно содержать рабочий метод `main()` для запуска генератора отчетов. Отчеты собирать в
директорию `reports` в корневой папке проекта.

# Решение

### Структура проекта

```
    .
    ├── data
    |   └── cdr.txt
    ├── reports
    |   └── report.txt
    ├── src
    |   └── main
    |       └── java
    |             ├── calculation
    |             |     └── RateCalculation.java
    |             ├── model
    |             |     └── UserInfoModel.java
    |             ├── parser
    |             |     └── FileParser.java
    |             ├── report
    |             |     └── ReportGeneration.java
    |             └── Main.java
    ├── .gitignore
    ├── pom.xml
    └── README.md
```

### Описание классов и методов

- `UserInfoModel` - модель данных, которая используется в списке звонков, содержит в себе геттеры и сеттеры, а также
следующие поля:
    - `phoneNumber` - номер телефона пользователя
    - `callType` - тип звонка (исходящий, входящий)
    - `startDate` - начальная дата звонка
    - `endDate` - конечная дата звонка
    - `duration` - продолжительность звонка
    - `rate` - тариф (безлимит, поминутный, обычный)


- `FileParser` - необходим для обработки файла `cdr.txt` с данными. Содержит следующие методы:
    - `List<UserInfoModel> findUserInfo(String phoneNumber)` - метод для подготовки списка звонков, совершенных
    пользователем, номер которого передается в параметрах `phoneNumber`
    - `Date stringToDate(String stringDate)` - метод для конвертации даты типа `String` в тип `Date`
    - `double getDateDiff(Date startDate, Date endDate)` - метод, на вход которого подается начальная `startDate`
    и конечная `endDate` даты. Необходим для вычисления времени, которое пользователь потратил на звонок


- `RateCalculation` - класс для вычисления всех тарифов. Содержит следующие методы:
    - `double unlimitedRate(double seconds, boolean higherThanLimit)` - метод для рассчета стоимости звонка для безлимитного
    тарифа. Принимает на вход время разговора `seconds` и флаг `higherThanLimit`, означающий превышение лимита.
    Вычисления производятся для каждого звонка по формуле процента от числа:
        - До превышения: `(seconds * price) / (time * 60)`
        - После: `seconds / 60`

    - `double perMinuteRate(double seconds)` - метод для рассчета стоимости звонка для поминутного тарифа. Принимает
    на вход время разговора `seconds`. Вычисления производятся для каждого звонка по формуле процента от числа:
        - `(seconds * price) / 60`

    - `double basicRate(double seconds, boolean higherThanLimit)` - метод для рассчета стоимости звонка для обычного
    тарифа. Принимает на вход время разговора `seconds` и флаг `higherThanLimit`, означающий превышение лимита.
    Вычисления производятся для каждого звонка по формуле процента от числа:
        - До превышения: `(seconds * price) / (time * 60)`
        - После: `perMinuteRate(seconds)`
    
    - `List<Double> unlimitedCalculation(List<UserInfoModel> userInfo)` - метод необходимый для генерации списка стоимостей
    по безлимитному тарифу, принимает на вход список звонков пользователя `userInfo`
    
    - `List<Double> basicCalculation(List<UserInfoModel> userInfo)` - метод необходимый для генерации списка стоимостей
    по обычному тарифу, принимает на вход список звонков пользователя `userInfo`
    
    - `List<Double> perMinuteCalculation(List<UserInfoModel> userInfo)` - метод необходимый для генерации списка стоимостей
    по поминутному тарифу, принимает на вход список звонков пользователя `userInfo`


- `ReportGeneration` - класс для генерации отчета в директорию `reports`. Содержит следующие методы:
    - `StringBuilder prepareData(String rate)` - метод для подготовки данных, принимает на вход тариф пользователя `rate`,
    возвращает `StringBuilder` для дальнейшей записи в файл
    - `void writeToFile()` - метод, который генерирует файл `report.txt` и записывает в него `StringBuilder`

### Запуск

- Для запуска Вам необходимо клонировать на свой компьютер репозиторий. Либо скачать `.zip` архив с проектом.
Запустить проект, например, в `IntelliJ Idea`, предварительно указав понравившийся номер телефона, который будем пробивать
по файлу

### Результаты

- Получившийся отчет выглядит следующим образом:

```
Tariff index: 03
-------------------------------------------------------------------------------------------------------------------------------------------------
Report for phone number 79270106185:
-------------------------------------------------------------------------------------------------------------------------------------------------
|	Call Type	|		Start Time		|	End Time			|	Duration	|	Cost	|
-------------------------------------------------------------------------------------------------------------------------------------------------
|	01		|	Thu Mar 30 21:21:46 MSK 2023	|	Thu Mar 30 21:31:59 MSK 2023	|	00:10:13	|	15.325	|
|	02		|	Thu Nov 16 23:51:31 MSK 2023	|	Thu Nov 16 23:53:21 MSK 2023	|	00:01:50	|	2.75	|
|	02		|	Sat Nov 04 18:08:52 MSK 2023	|	Sat Nov 04 18:20:44 MSK 2023	|	00:11:52	|	17.8	|
|	01		|	Wed May 03 05:01:34 MSK 2023	|	Wed May 03 05:03:29 MSK 2023	|	00:01:55	|	2.875	|
|	02		|	Sat Oct 21 03:35:12 MSK 2023	|	Sat Oct 21 03:39:22 MSK 2023	|	00:04:10	|	6.25	|
|	02		|	Sat Apr 22 18:16:38 MSK 2023	|	Sat Apr 22 18:24:07 MSK 2023	|	00:07:29	|	11.225	|
|	02		|	Sat Nov 18 01:40:17 MSK 2023	|	Sat Nov 18 01:45:19 MSK 2023	|	00:05:02	|	7.55	|
|	02		|	Thu Nov 09 23:31:28 MSK 2023	|	Thu Nov 09 23:33:53 MSK 2023	|	00:02:25	|	3.625	|
|	01		|	Mon Jul 31 01:45:03 MSK 2023	|	Mon Jul 31 01:45:08 MSK 2023	|	00:00:05	|	0.125	|
|	01		|	Tue Feb 28 17:49:11 MSK 2023	|	Tue Feb 28 17:49:14 MSK 2023	|	00:00:03	|	0.075	|
|	01		|	Wed Mar 22 05:49:29 MSK 2023	|	Wed Mar 22 06:01:04 MSK 2023	|	00:11:35	|	17.375	|
|	01		|	Sun Jul 23 20:32:07 MSK 2023	|	Sun Jul 23 20:43:23 MSK 2023	|	00:11:16	|	16.9	|
|	01		|	Fri Apr 14 14:31:03 MSK 2023	|	Fri Apr 14 14:35:37 MSK 2023	|	00:04:34	|	6.85	|
|	02		|	Wed Mar 29 07:58:11 MSK 2023	|	Wed Mar 29 08:03:26 MSK 2023	|	00:05:15	|	7.875	|
|	02		|	Sun Jul 02 00:59:09 MSK 2023	|	Sun Jul 02 01:01:44 MSK 2023	|	00:02:35	|	3.875	|
-------------------------------------------------------------------------------------------------------------------------------------------------
|											    Total Cost: |			120.475 rubles 	|
-------------------------------------------------------------------------------------------------------------------------------------------------
			/Powered by Vyacheslav Seleznev/
```
